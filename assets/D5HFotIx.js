import{r as t,j as e}from"./DlapfqMS.js";import{a as n,c as i,u as o,d as a,M as s}from"./PnKjS81K.js";function r({url:n,isLowPower:r}){const l=i(n),c=t.useRef(null),d=o(t=>t.gl),p=o(t=>t.invalidate),u=t.useRef(null);return t.useEffect(()=>{const t=c.current;if(!t)return;const e=function(t){const{element:e,model:n,onInput:i,invertHorizontal:o=!0,rotateSpeedX:a=.05,rotateSpeedY:r=.05,maxRotationX:l=Math.PI/3,minRotationX:c=-Math.PI/4,maxRotationY:d=Math.PI+Math.PI/4,minRotationY:p=Math.PI-Math.PI/4,enableLean:u=window.matchMedia?.("(pointer: fine)")?.matches??!0,maxLeanX:h=1,maxLeanY:m=1,leanLerpSpeed:x=.1}=t;n.rotation.y=Math.PI;let f=0,w=Math.PI;const M=n.position.x,g=n.position.y;let b=M,I=g,v=window.innerWidth/2,y=window.innerHeight/2,j=!1;const L=new AbortController,P=(t,n)=>{const i=e.getBoundingClientRect(),a=Math.max(1,i.width),s=Math.max(1,i.height),r=(t-i.left)/a*2-1,l=(n-i.top)/s*2-1;w=Math.PI+(o?-1:1)*r*Math.PI,f=-l*Math.PI,u&&(b=M+r*h,I=g+-l*m)},R=()=>{try{i?.()}catch{}};return e.addEventListener("pointermove",t=>{j=!0,v=t.clientX,y=t.clientY,P(t.clientX,t.clientY),R()},{passive:!0,signal:L.signal}),window.addEventListener("scroll",()=>{j&&(P(v,y),R())},{passive:!0,signal:L.signal}),window.addEventListener("wheel",()=>{j&&(P(v,y),R())},{passive:!0,signal:L.signal}),{update:()=>{const t=n.rotation.y+(w-n.rotation.y)*r;n.rotation.y=s.clamp(t,p,d);const e=n.rotation.x+(f-n.rotation.x)*a;n.rotation.x=s.clamp(e,c,l),u&&(n.position.x+=(b-n.position.x)*x,n.position.y+=(I-n.position.y)*x);const i=1e-4,o=1e-4,h=Math.abs(f-n.rotation.x)>i||Math.abs(w-n.rotation.y)>i,m=!!u&&(Math.abs(b-n.position.x)>o||Math.abs(I-n.position.y)>o);return h||m},dispose:()=>L.abort()}}({element:d.domElement,model:t,onInput:()=>p(),enableLean:!r&&(window.matchMedia?.("(pointer: fine)")?.matches??!0)});return u.current=e,p(),()=>{e.dispose(),u.current=null}},[d,p,r]),a(t=>{const e=u.current;e&&e.update()&&t.invalidate()}),e.jsx("group",{ref:c,position:[0,-.65,0],children:e.jsx("primitive",{object:l.scene,scale:.5})})}function l(){const i="/web2/",o=t.useMemo(()=>`${i}assets/DarkStar.glb`,[i]),[a,s]=t.useState(!1),l=t.useRef(null);return t.useEffect(()=>{let t=!1;const e=()=>{t||s(!0)},n=window.requestIdleCallback;if("function"==typeof n?n(()=>e(),{timeout:1500}):window.setTimeout(()=>e(),0),"undefined"!=typeof IntersectionObserver&&l.current){const n=new IntersectionObserver(t=>{const n=t[0];n?.isIntersecting&&e()},{root:null,threshold:.01,rootMargin:"400px 0px 400px 0px"});return n.observe(l.current),()=>{t=!0,n.disconnect()}}return()=>{t=!0}},[]),e.jsx("div",{ref:l,style:{width:"100%",height:"100%"},children:a?e.jsxs(n,{dpr:[1,2],frameloop:"demand",camera:{fov:75,near:.1,far:1e3,position:[0,0,5]},gl:{antialias:!0,alpha:!0},children:[e.jsx("ambientLight",{intensity:.45}),e.jsx("directionalLight",{position:[5,6,4],intensity:1}),e.jsx("directionalLight",{position:[-5,2,-2],intensity:.35}),e.jsx(t.Suspense,{fallback:null,children:e.jsx(r,{url:o,isLowPower:!1})})]}):null})}export{l as DarkstarCanvasImpl};
